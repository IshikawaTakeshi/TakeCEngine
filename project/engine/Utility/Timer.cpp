#include "Timer.h"
#include "engine/base/TakeCFrameWork.h"
#include <algorithm>

//=============================================================================
// コンストラクタ
//=============================================================================
Timer::Timer(float _duration, float current) {
	// 初期化
	Initialize(_duration, current);
}

//=============================================================================
// 初期化
//=============================================================================
void Timer::Initialize(float _duration, float current) {
	duration_ = _duration;
	currentTime_ = current;
	prevTime_ = currentTime_;
	isStop_ = false; // タイマーは動作中に設定
}

//=============================================================================
// 進捗の取得(0.0~1.0)
//=============================================================================
float Timer::GetProgress() const {
	return currentTime_ / duration_;
}

//=============================================================================
// 期間の取得
//=============================================================================
float Timer::GetDuration() const {
	return duration_;
}

//=============================================================================
// イージング適用後の進捗の取得
//=============================================================================
float Timer::GetEase(Easing::EasingType easeType) {
	return Easing::Ease[easeType](GetProgress());
}

//=============================================================================
// 前回の進捗の取得(0.0~1.0)
//=============================================================================
float Timer::GetPrevProgress() const {
	return prevTime_ / duration_;
}

//=============================================================================
// タイマーが終了したかどうかの取得
//=============================================================================
bool Timer::IsFinished() const {
	return currentTime_ >= duration_;
}

//=============================================================================
// タイマーが現在終了しているかどうかの取得
//=============================================================================
bool Timer::IsFinishedNow() const {
	return currentTime_ >= duration_;
}

//=============================================================================
// タイマーのリセット
//=============================================================================
void Timer::Reset() {
	currentTime_ = 0.0f;
}

//=============================================================================
// タイマーを終了時間にする
//=============================================================================
void Timer::ToEnd() {
	currentTime_ = duration_;
}

//=============================================================================
// タイマーの再スタート
//=============================================================================
void Timer::Restart() {
	currentTime_ = 0.0f;
	isStop_ = false;
}

//=============================================================================
// タイマーの停止
//=============================================================================
void Timer::Update(float timeScale) {
	prevTime_ = currentTime_;
	currentTime_ = std::clamp(currentTime_ + TakeCFrameWork::GetDeltaTime() * timeScale * !isStop_, 0.0f, duration_);
}